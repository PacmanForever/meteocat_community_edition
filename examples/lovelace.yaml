# ==============================================================================
# EXEMPLES DE TARGETES LOVELACE - Meteocat (Community Edition)
# ==============================================================================
#
# Aquest fitxer cont√© exemples de targetes personalitzades per al dashboard
# de Home Assistant utilitzant la integraci√≥ Meteocat.
#
# NOTA: Canvia els noms d'entitats per adaptar-los a la teva configuraci√≥!
#
# Per afegir-les al teu dashboard:
# 1. Edita el dashboard en mode YAML
# 2. Copia i enganxa les targetes que necessitis
# 3. Adapta els entity_id segons la teva configuraci√≥
#
# ==============================================================================

# ------------------------------------------------------------------------------
# 1. TARGETA WEATHER - MODE ESTACI√ì
# ------------------------------------------------------------------------------

# Targeta Weather est√†ndard per Mode Estaci√≥
type: weather-forecast
entity: weather.granollers_ym  # Canvia per la teva entitat
show_forecast: true

# ------------------------------------------------------------------------------
# 2. TARGETES PERSONALITZADES - MODE MUNICIPAL
# ------------------------------------------------------------------------------

# Predicci√≥ hor√†ria amb markdown
type: markdown
content: |
  ## üìä Predicci√≥ hor√†ria - Pr√≤ximes 24h
  
  {% set forecast = state_attr('sensor.granollers_prediccio_horaria', 'forecast') %}
  {% if forecast and forecast.dies %}
    {% set avui = forecast.dies[0] %}
    {% set ara = now().hour %}
    
    | Hora | üå°Ô∏è Temp | üíß Humitat | üí® Vent | ‚òî Pluja |
    |------|---------|-----------|---------|---------|
    {% for h in range(ara, 24) %}
    | {{ '%02d' % h }}:00 | {{ avui.variables.temp.valors[h] | round(1) }}¬∞C | {{ avui.variables.hr.valors[h] | round(0) }}% | {{ avui.variables.ws.valors[h] | round(0) }} km/h | {{ avui.variables.ppcp.valors[h] | default(0) | round(1) }} mm |
    {% endfor %}
  {% else %}
    _Dades no disponibles_
  {% endif %}
title: Predicci√≥ hor√†ria

# Predicci√≥ di√†ria amb markdown
type: markdown
content: |
  ## üìÖ Predicci√≥ di√†ria - Pr√≤xims 7 dies
  
  {% set forecast = state_attr('sensor.granollers_prediccio_diaria', 'forecast') %}
  {% if forecast and forecast.dies %}
    
    | Data | üå°Ô∏è Min/Max | ‚òî Pluja | üíß Humitat |
    |------|-----------|---------|-----------|
    {% for dia in forecast.dies[:7] %}
    | {{ dia.data }} | {{ dia.variables.tmin.valor | round(1) }}¬∞ / {{ dia.variables.tmax.valor | round(1) }}¬∞C | {{ dia.variables.ppcp.valor | default(0) | round(1) }} mm | {{ dia.variables.hrmin.valor | round(0) }}-{{ dia.variables.hrmax.valor | round(0) }}% |
    {% endfor %}
  {% else %}
    _Dades no disponibles_
  {% endif %}
title: Predicci√≥ Setmanal

# ------------------------------------------------------------------------------
# 3. TARGETES DE QUOTES API
# ------------------------------------------------------------------------------

# Vista vertical amb totes les quotes
type: vertical-stack
cards:
  - type: horizontal-stack
    cards:
      - type: entity
        entity: sensor.granollers_ym_quota_prediccio
        name: Predicci√≥
        icon: mdi:weather-partly-cloudy
      
      - type: entity
        entity: sensor.granollers_ym_quota_referencia
        name: Refer√®ncia
        icon: mdi:map-marker
  
  - type: horizontal-stack
    cards:
      - type: entity
        entity: sensor.granollers_ym_quota_xdde
        name: XDDE
        icon: mdi:database
      
      - type: entity
        entity: sensor.granollers_ym_quota_xema
        name: XEMA
        icon: mdi:weather-pouring

# Targeta amb detalls de quotes (custom button-card recomanat)
type: custom:button-card
entity: sensor.granollers_ym_quota_prediccio
name: Quotes API Predicci√≥
show_state: true
show_label: true
label: |
  [[[
    const limit = states['sensor.granollers_ym_quota_prediccio'].attributes.limit;
    const used = states['sensor.granollers_ym_quota_prediccio'].attributes.used;
    const reset = states['sensor.granollers_ym_quota_prediccio'].attributes.reset_date;
    return `Usades: ${used}/${limit}<br>Reset: ${reset}`;
  ]]]
styles:
  card:
    - height: 120px
  label:
    - font-size: 12px
    - margin-top: 10px

# ------------------------------------------------------------------------------
# 4. TARGETES DE TIMESTAMPS
# ------------------------------------------------------------------------------

# Informaci√≥ d'actualitzacions
type: entities
entities:
  - entity: sensor.granollers_ym_last_update
    name: √öltima actualitzaci√≥
    icon: mdi:clock-check
  
  - entity: sensor.granollers_ym_next_update
    name: Pr√≤xima actualitzaci√≥
    icon: mdi:clock-outline
  
  - entity: sensor.granollers_ym_update_time_1
    name: Hora actualitzaci√≥ 1
    icon: mdi:clock-time-one
  
  - entity: sensor.granollers_ym_update_time_2
    name: Hora actualitzaci√≥ 2
    icon: mdi:clock-time-two
  
  - entity: button.granollers_ym_refresh
    name: Actualitzar ara
    icon: mdi:refresh
title: Gesti√≥ Actualitzacions

# ------------------------------------------------------------------------------
# 5. DASHBOARD COMPLET - MODE ESTACI√ì
# ------------------------------------------------------------------------------

type: vertical-stack
title: "üå¶Ô∏è Meteocat - Granollers"
cards:
  # Targeta principal Weather
  - type: weather-forecast
    entity: weather.granollers_ym
    show_forecast: true
  
  # Informaci√≥ d'actualitzacions
  - type: horizontal-stack
    cards:
      - type: entity
        entity: sensor.granollers_ym_last_update
        name: √öltima
        icon: mdi:clock-check
      
      - type: entity
        entity: sensor.granollers_ym_next_update
        name: Pr√≤xima
        icon: mdi:clock-outline
      
      - type: button
        entity: button.granollers_ym_refresh
        name: Actualitzar
        icon: mdi:refresh
        tap_action:
          action: call-service
          service: button.press
          service_data:
            entity_id: button.granollers_ym_refresh
  
  # Quotes API
  - type: horizontal-stack
    cards:
      - type: sensor
        entity: sensor.granollers_ym_quota_prediccio
        name: Predicci√≥
        graph: line
      
      - type: sensor
        entity: sensor.granollers_ym_quota_xema
        name: XEMA
        graph: line

# ------------------------------------------------------------------------------
# 6. DASHBOARD COMPLET - MODE MUNICIPAL
# ------------------------------------------------------------------------------

type: vertical-stack
title: "üèôÔ∏è Prediccions - Granollers"
cards:
  # Resum del dia
  - type: markdown
    content: |
      ## üìç {{ state_attr('sensor.granollers_prediccio_diaria', 'forecast').nom if state_attr('sensor.granollers_prediccio_diaria', 'forecast') else 'Granollers' }}
      
      {% set forecast = state_attr('sensor.granollers_prediccio_diaria', 'forecast') %}
      {% if forecast and forecast.dies %}
        {% set avui = forecast.dies[0] %}
        
        ### Avui - {{ avui.data }}
        
        üå°Ô∏è **Temperatura:** {{ avui.variables.tmin.valor }}¬∞C - {{ avui.variables.tmax.valor }}¬∞C
        
        ‚òî **Pluja:** {{ avui.variables.ppcp.valor | default(0) }} mm
        
        üíß **Humitat:** {{ avui.variables.hrmin.valor }}% - {{ avui.variables.hrmax.valor }}%
      {% else %}
        _Carregant dades..._
      {% endif %}
  
  # Predicci√≥ hor√†ria
  - type: markdown
    content: |
      ### üïê Pr√≤ximes hores
      
      {% set forecast = state_attr('sensor.granollers_prediccio_horaria', 'forecast') %}
      {% if forecast and forecast.dies %}
        {% set avui = forecast.dies[0] %}
        {% set ara = now().hour %}
        
        | Hora | Temp | Pluja | Vent |
        |------|------|-------|------|
        {% for h in range(ara, min(ara + 6, 24)) %}
        | {{ '%02d' % h }}h | {{ avui.variables.temp.valors[h] | round(1) }}¬∞C | {{ avui.variables.ppcp.valors[h] | default(0) | round(1) }}mm | {{ avui.variables.ws.valors[h] | round(0) }}km/h |
        {% endfor %}
      {% endif %}
  
  # Predicci√≥ setmanal
  - type: markdown
    content: |
      ### üìÖ Pr√≤xims dies
      
      {% set forecast = state_attr('sensor.granollers_prediccio_diaria', 'forecast') %}
      {% if forecast and forecast.dies %}
        {% for dia in forecast.dies[1:6] %}
        **{{ dia.data }}**: {{ dia.variables.tmin.valor }}¬∞C - {{ dia.variables.tmax.valor }}¬∞C, {{ dia.variables.ppcp.valor | default(0) }}mm
        {% endfor %}
      {% endif %}
  
  # Bot√≥ actualitzaci√≥ i quotes
  - type: horizontal-stack
    cards:
      - type: button
        entity: button.granollers_refresh
        name: Actualitzar
        icon: mdi:refresh
        tap_action:
          action: call-service
          service: button.press
          service_data:
            entity_id: button.granollers_refresh
      
      - type: entity
        entity: sensor.granollers_quota_prediccio
        name: Quotes
        icon: mdi:counter

# ------------------------------------------------------------------------------
# 7. TARGETES AVAN√áADES AMB CUSTOM CARDS
# ------------------------------------------------------------------------------

# Mini Graph Card per visualitzar tend√®ncies (requereix custom:mini-graph-card)
type: custom:mini-graph-card
entities:
  - entity: sensor.granollers_quota_prediccio
    name: Predicci√≥
  - entity: sensor.granollers_quota_xema
    name: XEMA
name: √ös Quotes API
hours_to_show: 168
points_per_hour: 0.5
line_width: 2
font_size: 75
show:
  labels: true
  points: false

# Apexcharts per gr√†fics avan√ßats (requereix custom:apexcharts-card)
type: custom:apexcharts-card
header:
  show: true
  title: Temperatura Prevista
series:
  - entity: sensor.granollers_prediccio_horaria
    data_generator: |
      const forecast = entity.attributes.forecast;
      if (!forecast || !forecast.dies) return [];
      const data = [];
      forecast.dies.forEach(dia => {
        dia.variables.temp.valors.forEach((temp, hora) => {
          const timestamp = new Date(dia.data + 'T' + String(hora).padStart(2, '0') + ':00:00');
          data.push([timestamp.getTime(), temp]);
        });
      });
      return data;
    name: Temperatura
    type: line
    color: '#ff6384'

# Mushroom Cards per disseny modern (requereix custom:mushroom-cards)
type: vertical-stack
cards:
  - type: custom:mushroom-title-card
    title: Meteocat Granollers
  
  - type: custom:mushroom-entity-card
    entity: weather.granollers_ym
    icon: mdi:weather-partly-cloudy
    name: Estat Actual
  
  - type: custom:mushroom-chips-card
    chips:
      - type: entity
        entity: sensor.granollers_ym_last_update
        icon: mdi:clock-check
      
      - type: entity
        entity: button.granollers_ym_refresh
        icon: mdi:refresh
        tap_action:
          action: call-service
          service: button.press
          service_data:
            entity_id: button.granollers_ym_refresh

# ------------------------------------------------------------------------------
# 8. TARGETA AMB MAPA (MODE ESTACI√ì)
# ------------------------------------------------------------------------------

# Targeta de mapa mostrant ubicaci√≥ de l'estaci√≥
type: map
entities:
  - entity: weather.granollers_ym
default_zoom: 12
dark_mode: auto

# ------------------------------------------------------------------------------
# 9. TARGETA CONDICIONAL - MOSTRA AVISOS
# ------------------------------------------------------------------------------

# Mostra av√≠s nom√©s si far√† molt de calor
type: conditional
conditions:
  - entity: sensor.granollers_prediccio_diaria
    state_not: unavailable
  - condition: template
    value_template: >
      {% set forecast = state_attr('sensor.granollers_prediccio_diaria', 'forecast') %}
      {{ forecast.dies[0].variables.tmax.valor | float > 30 if forecast else false }}
card:
  type: markdown
  content: |
    ## ‚ö†Ô∏è Av√≠s Temperatura Alta
    
    Avui es preveuen m√©s de 30¬∞C!
    
    Recorda beure molta aigua i evitar l'exposici√≥ solar durant les hores centrals del dia.
  card_mod:
    style: |
      ha-card {
        background-color: rgba(255, 165, 0, 0.2);
        border-left: 4px solid orange;
      }

# Mostra av√≠s nom√©s si plour√†
type: conditional
conditions:
  - entity: sensor.granollers_prediccio_diaria
    state_not: unavailable
  - condition: template
    value_template: >
      {% set forecast = state_attr('sensor.granollers_prediccio_diaria', 'forecast') %}
      {{ forecast.dies[0].variables.ppcp.valor | default(0) | float > 5 if forecast else false }}
card:
  type: markdown
  content: |
    ## ‚òî Av√≠s de Pluja
    
    Avui es preveuen m√©s de 5mm de pluja.
    
    Porta't el paraigua!
  card_mod:
    style: |
      ha-card {
        background-color: rgba(0, 123, 255, 0.2);
        border-left: 4px solid blue;
      }

# ------------------------------------------------------------------------------
# 10. TARGETA DE TEND√àNCIES (requereix Sensors Template personalitzats)
# ------------------------------------------------------------------------------

# Crear primer aquests sensors template a configuration.yaml:
# 
# template:
#   - sensor:
#       - name: "Tend√®ncia Temperatura Dem√†"
#         unit_of_measurement: "¬∞C"
#         state: >
#           {% set forecast = state_attr('sensor.granollers_prediccio_diaria', 'forecast') %}
#           {% if forecast and forecast.dies | length > 1 %}
#             {{ (forecast.dies[1].variables.tmax.valor - forecast.dies[0].variables.tmax.valor) | round(1) }}
#           {% else %}
#             0
#           {% endif %}

type: entities
entities:
  - type: custom:template-entity-row
    entity: sensor.tendencia_temperatura_dema
    name: Tend√®ncia Temperatura
    state: >
      {% if states('sensor.tendencia_temperatura_dema') | float > 0 %}
        ‚¨ÜÔ∏è +{{ states('sensor.tendencia_temperatura_dema') }}¬∞C respecte avui
      {% elif states('sensor.tendencia_temperatura_dema') | float < 0 %}
        ‚¨áÔ∏è {{ states('sensor.tendencia_temperatura_dema') }}¬∞C respecte avui
      {% else %}
        ‚û°Ô∏è Igual que avui
      {% endif %}

# ==============================================================================
# FI D'EXEMPLES
# ==============================================================================
#
# Per m√©s informaci√≥ sobre Lovelace i custom cards:
# - https://www.home-assistant.io/lovelace/
# - HACS per instal¬∑lar custom cards
#
# Repositori del projecte:
# https://github.com/PacmanForever/meteocat_community_edition
#
# ==============================================================================
